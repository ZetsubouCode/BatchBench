<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ config.APP_NAME or "BatchBench" }}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    :root{
      --bb-bg:#0b1220; --bb-card:#0f172a; --bb-border:#1f2a44;
      --bb-text:#e6edf3; --bb-muted:#a9bbcf;
      --bb-link:#79c0ff; --bb-link-hover:#a5d6ff;
      --bb-input-bg:#0b1220; --bb-input-bd:#3b4b6b; --bb-input-ph:#c4d2e1;
      --bb-primary:#3b82f6; --bb-primary-hover:#2563eb;
      --bb-code-bg:#0a1020; --bb-code-bd:#23314f; --bb-focus:#8ab4ff;
      --bs-body-bg:var(--bb-bg); --bs-body-color:var(--bb-text);
      --bs-heading-color:var(--bb-text); --bs-secondary-color:var(--bb-muted);
      --bs-tertiary-color:var(--bb-muted); --bs-border-color:var(--bb-border);
    }
    body{background:var(--bb-bg);color:var(--bb-text);}
    .navbar,.card{background:var(--bb-card);border:1px solid var(--bb-border);}
    .navbar .navbar-brand{color:var(--bb-text);}
    h1,h2,h3,h4,h5,h6,p,li,label{color:var(--bb-text);}
    .text-muted,.text-body-secondary,.small-note{color:var(--bb-muted)!important;}
    a{color:var(--bb-link);} a:hover,a:focus{color:var(--bb-link-hover);}
    .form-control,.form-select{background:var(--bb-input-bg);color:var(--bb-text);border-color:var(--bb-input-bd);}
    .form-control::placeholder{color:var(--bb-input-ph);opacity:1;}
    .form-select option{background:var(--bb-input-bg);color:var(--bb-text);}
    .btn-primary{background:var(--bb-primary);border-color:var(--bb-primary);}
    .btn-primary:hover,.btn-primary:focus{background:var(--bb-primary-hover);border-color:var(--bb-primary-hover);}
    pre{background:var(--bb-code-bg);color:var(--bb-text);padding:1rem;border-radius:.5rem;border:1px solid var(--bb-code-bd);overflow-x:auto;}
    :focus-visible{outline:2px solid var(--bb-focus);outline-offset:2px;}
    .list-group-item{background:var(--bb-card);color:var(--bb-text);border-color:var(--bb-border);}
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark mb-4">
    <div class="container">
      <a class="navbar-brand" href="/">{{ config.APP_NAME or "BatchBench" }}</a>
    </div>
  </nav>

  <div class="container pb-5">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-info">{% for m in messages %}<div>{{ m }}</div>{% endfor %}</div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </div>

  <!-- Folder Picker Modal -->
  <div class="modal fade" id="folderPicker" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content" style="background:var(--bb-card);color:var(--bb-text);border:1px solid var(--bb-border);">
        <div class="modal-header">
          <h5 class="modal-title">Choose a folder</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex gap-2 mb-2">
            <button class="btn btn-sm btn-secondary" id="bb-up">Up one level</button>
            <div class="flex-grow-1">
              <input id="bb-current" class="form-control form-control-sm" readonly>
            </div>
          </div>
          <ul id="bb-list" class="list-group small"></ul>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" id="bb-select">Use this folder</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let bbTargetInput = null;
    let bbPath = "";

    async function bbGet(url){ const r = await fetch(url); return await r.json(); }

    async function bbShowDrives(){
      const data = await bbGet("/api/drives");
      const list = document.getElementById("bb-list"); list.innerHTML = "";
      document.getElementById("bb-current").value = "(choose a drive)";
      (data.drives||[]).forEach(d=>{
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.textContent = d;
        li.style.cursor="pointer";
        li.onclick = ()=> bbOpen(d);
        list.appendChild(li);
      });
      bbPath = "";
    }

    async function bbOpen(path){
      const data = await bbGet("/api/list-dir?path="+encodeURIComponent(path));
      bbPath = data.path || path;
      document.getElementById("bb-current").value = bbPath;
      const list = document.getElementById("bb-list"); list.innerHTML = "";
      (data.dirs||[]).forEach(p=>{
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.textContent = p;
        li.style.cursor="pointer";
        li.onclick = ()=> bbOpen(p);
        list.appendChild(li);
      });
      document.getElementById("bb-up").onclick = ()=> bbOpen(data.parent || path);
    }

    document.addEventListener("click", (e)=>{
      const btn = e.target.closest(".btn-browse");
      if(!btn) return;
      const targetId = btn.getAttribute("data-target");
      bbTargetInput = document.getElementById(targetId);
      const modal = new bootstrap.Modal(document.getElementById("folderPicker"));
      modal.show();
      bbShowDrives();
      document.getElementById("bb-select").onclick = ()=>{
        if(bbTargetInput && bbPath){ bbTargetInput.value = bbPath; }
        modal.hide();
      };
    });
  </script>
</body>
</html>
